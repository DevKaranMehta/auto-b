{% extends "admin/base.html" %}

{% block title %}{% if post %}Edit Post{% else %}Create New Post{% endif %}{% endblock %}

{% block content %}
<div class="page-header">
    <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 20px;">
        <div>
            <h1 class="page-title">{% if post %}Edit Post{% else %}Create New Post{% endif %}</h1>
            <p class="page-subtitle">{% if post %}Update your blockchain article{% else %}Write engaging content for your blockchain audience{% endif %}</p>
        </div>
        <a href="{{ url_for('admin_posts') }}" class="btn btn-secondary">
            ‚Üê Back to Posts
        </a>
    </div>
</div>

<div class="card">
    <div class="card-header">
        <h3 class="card-title">{% if post %}{{ post.title[:60] }}{% if post.title|length > 60 %}...{% endif %}{% else %}New Article{% endif %}</h3>
    </div>

    <div class="card-body">
        <form method="POST">
            <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 32px;">
                <!-- Main Content -->
                <div>
                    <div class="form-group">
                        <label class="form-label">Article Title</label>
                        <input type="text" name="title" class="form-input" 
                               value="{{ post.title if post else '' }}" 
                               placeholder="Enter an engaging title for your blockchain article..." required>
                        <small style="color: var(--text-gray); font-size: 12px;">Make it compelling and SEO-friendly (recommended: 50-60 characters)</small>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Article Excerpt</label>
                        <textarea name="excerpt" class="form-textarea" rows="3"
                                  placeholder="Write a brief summary that will appear in article previews...">{{ post.excerpt if post else '' }}</textarea>
                        <small style="color: var(--text-gray); font-size: 12px;">Brief description for social media and article previews (recommended: 150-160 characters)</small>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Article Content</label>
                        <div style="background: rgba(240, 185, 11, 0.05); padding: 16px; border-radius: 8px; margin-bottom: 12px; border: 1px solid rgba(240, 185, 11, 0.2);">
                            <div style="display: flex; gap: 8px; flex-wrap: wrap;">
                                <button type="button" class="btn" onclick="insertText('**', '**')" style="padding: 6px 12px; font-size: 12px; background: var(--card-bg); border: 1px solid var(--primary-gold); color: var(--primary-gold);"><strong>B</strong></button>
                                <button type="button" class="btn" onclick="insertText('*', '*')" style="padding: 6px 12px; font-size: 12px; background: var(--card-bg); border: 1px solid var(--primary-gold); color: var(--primary-gold);"><em>I</em></button>
                                <button type="button" class="btn" onclick="insertText('### ', '')" style="padding: 6px 12px; font-size: 12px; background: var(--card-bg); border: 1px solid var(--primary-gold); color: var(--primary-gold);">H3</button>
                                <button type="button" class="btn" onclick="insertText('- ', '')" style="padding: 6px 12px; font-size: 12px; background: var(--card-bg); border: 1px solid var(--primary-gold); color: var(--primary-gold);">List</button>
                                <button type="button" class="btn" onclick="insertText('[Link](', ')')" style="padding: 6px 12px; font-size: 12px; background: var(--card-bg); border: 1px solid var(--primary-gold); color: var(--primary-gold);">üîó</button>
                                <button type="button" class="btn" onclick="insertHTML('<p><strong>Key Points:</strong></p><ul><li></li><li></li></ul>')" style="padding: 6px 12px; font-size: 12px; background: var(--card-bg); border: 1px solid var(--primary-gold); color: var(--primary-gold);">üìù</button>
                            </div>
                        </div>
                        <textarea name="content" class="form-textarea" rows="20"
                                  placeholder="Write your comprehensive blockchain article here... You can use HTML tags for formatting.">{{ post.content if post else '' }}</textarea>
                        <small style="color: var(--text-gray); font-size: 12px;">Use HTML for rich formatting. Include headings, lists, and emphasis for better readability.</small>
                    </div>
                </div>

                <!-- Sidebar Settings -->
                <div>
                    <div class="form-group">
                        <label class="form-label">Category</label>
                        <select name="category_id" class="form-select">
                            <option value="">Select Category</option>
                            {% for category in categories %}
                            <option value="{{ category.id }}" 
                                    {% if post and post.category_id == category.id %}selected{% endif %}>
                                {{ category.name }}
                            </option>
                            {% endfor %}
                        </select>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Publishing Options</label>
                        <div style="display: grid; gap: 12px;">
                            <label style="display: flex; align-items: center; gap: 12px; cursor: pointer;">
                                <input type="checkbox" name="is_published" 
                                       {% if not post or post.is_published %}checked{% endif %}
                                       style="width: 18px; height: 18px; accent-color: var(--primary-gold);">
                                <span>Published</span>
                            </label>
                            <label style="display: flex; align-items: center; gap: 12px; cursor: pointer;">
                                <input type="checkbox" name="is_featured"
                                       {% if post and post.is_featured %}checked{% endif %}
                                       style="width: 18px; height: 18px; accent-color: var(--primary-gold);">
                                <span>Featured Article</span>
                            </label>
                        </div>
                    </div>

                    <div style="background: rgba(240, 185, 11, 0.05); padding: 20px; border-radius: 12px; border: 1px solid rgba(240, 185, 11, 0.2);">
                        <h4 style="color: var(--primary-gold); margin-bottom: 12px; font-size: 14px;">üìù Writing Tips</h4>
                        <ul style="color: var(--text-gray); font-size: 13px; line-height: 1.6; margin-left: 16px;">
                            <li>Use compelling headlines with keywords</li>
                            <li>Include market analysis and data</li>
                            <li>Add relevant blockchain terminology</li>
                            <li>Structure with clear headings</li>
                            <li>Include actionable insights</li>
                        </ul>
                    </div>

                    {% if post %}
                    <div style="background: rgba(14, 205, 240, 0.05); padding: 20px; border-radius: 12px; border: 1px solid rgba(14, 205, 240, 0.2); margin-top: 20px;">
                        <h4 style="color: var(--info-blue); margin-bottom: 12px; font-size: 14px;">üìä Article Stats</h4>
                        <div style="color: var(--text-gray); font-size: 13px; line-height: 1.6;">
                            <p><strong>Views:</strong> {{ post.views or 0 }}</p>
                            <p><strong>Created:</strong> {{ post.created_at.strftime('%m/%d/%Y %I:%M %p') }}</p>
                            {% if post.updated_at %}
                            <p><strong>Updated:</strong> {{ post.updated_at.strftime('%m/%d/%Y %I:%M %p') }}</p>
                            {% endif %}
                        </div>
                    </div>
                    {% endif %}
                </div>
            </div>

            <div style="display: flex; gap: 12px; justify-content: end; margin-top: 32px; padding-top: 24px; border-top: 1px solid #F0F1F2;">
                <a href="{{ url_for('admin_posts') }}" class="btn btn-secondary">Cancel</a>
                <button type="submit" class="btn btn-primary">
                    {% if post %}Update Post{% else %}Publish Post{% endif %}
                </button>
            </div>
        </form>
    </div>
</div>

<script>
function insertText(before, after) {
    const textarea = document.querySelector('textarea[name="content"]');
    const start = textarea.selectionStart;
    const end = textarea.selectionEnd;
    const selectedText = textarea.value.substring(start, end);
    const beforeText = textarea.value.substring(0, start);
    const afterText = textarea.value.substring(end);
    
    textarea.value = beforeText + before + selectedText + after + afterText;
    textarea.focus();
    textarea.setSelectionRange(start + before.length, end + before.length);
}

function insertHTML(html) {
    const textarea = document.querySelector('textarea[name="content"]');
    const start = textarea.selectionStart;
    const beforeText = textarea.value.substring(0, start);
    const afterText = textarea.value.substring(start);
    
    textarea.value = beforeText + html + afterText;
    textarea.focus();
    textarea.setSelectionRange(start + html.length, start + html.length);
}

// Auto-save functionality
let autoSaveTimer;
const contentEditor = document.querySelector('textarea[name="content"]');

contentEditor.addEventListener('input', function() {
    clearTimeout(autoSaveTimer);
    autoSaveTimer = setTimeout(() => {
        console.log('Auto-saving draft...');
        // Implement auto-save logic here if needed
    }, 3000);
});
</script>
{% endblock %}
