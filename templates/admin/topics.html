{% extends "admin/base.html" %}

{% block title %}Manage Topics{% endblock %}

{% block content %}
<div class="page-header">
    <div style="display: flex; justify-content: space-between; align-items: center;">
        <div>
            <h1 class="page-title">Content Topics</h1>
            <p class="page-subtitle">Manage topics for AI content generation</p>
        </div>
        <div style="display: flex; gap: 15px;">
            <button onclick="showImportModal()" class="btn btn-secondary">üìÅ Import CSV</button>
            <button onclick="showAddModal()" class="btn btn-primary">‚ûï Add Topic</button>
        </div>
    </div>
</div>

<!-- Topics List -->
<div class="card">
    <div class="card-header">
        <h3>All Topics ({{ topics|length }})</h3>
    </div>
    <div class="card-body">
        {% if topics %}
        <table class="table">
            <thead>
                <tr>
                    <th>Topic Name</th>
                    <th>Category</th>
                    <th>Status</th>
                    <th>Created</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for topic in topics %}
                <tr>
                    <td>
                        <strong>{{ topic.name }}</strong>
                    </td>
                    <td>
                        {% if topic.category_name %}
                        <span style="background: #e8f5e8; color: #2e7d32; padding: 4px 8px; border-radius: 4px; font-size: 0.8em;">
                            {{ topic.category_name }}
                        </span>
                        {% else %}
                        <span style="color: #999;">No category</span>
                        {% endif %}
                    </td>
                    <td>
                        <span style="color: {% if topic.is_active %}#28a745{% else %}#dc3545{% endif %};">
                            {{ '‚úÖ Active' if topic.is_active else '‚ùå Inactive' }}
                        </span>
                    </td>
                    <td>{{ topic.created_at.strftime('%m/%d/%Y') }}</td>
                    <td>
                        <div style="display: flex; gap: 8px;">
                            <button class="btn btn-secondary" style="padding: 6px 12px; font-size: 0.8em;" onclick="editTopic({{ topic.id }})">Edit</button>
                            <button class="btn btn-danger" style="padding: 6px 12px; font-size: 0.8em;" onclick="deleteTopic({{ topic.id }})">Delete</button>
                        </div>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        {% else %}
        <div style="text-align: center; padding: 40px; color: #666;">
            <div style="font-size: 3em; margin-bottom: 20px;">üìù</div>
            <h3>No topics yet</h3>
            <p>Add topics to start generating AI content automatically.</p>
            <button onclick="showAddModal()" class="btn btn-primary" style="margin-top: 20px;">Add Your First Topic</button>
        </div>
        {% endif %}
    </div>
</div>

<!-- Add Topic Modal -->
<div id="addModal" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 1000;">
    <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 30px; border-radius: 15px; width: 90%; max-width: 500px;">
        <h3 style="margin-bottom: 20px;">Add New Topic</h3>
        <form id="addTopicForm">
            <div class="form-group">
                <label class="form-label">Topic Name</label>
                <input type="text" name="topic_name" class="form-input" placeholder="e.g., DeFi Protocols, NFT Marketplace" required>
            </div>
            <div class="form-group">
                <label class="form-label">Category</label>
                <select name="category_id" class="form-select">
                    <option value="">Select Category</option>
                    {% for category in categories %}
                    <option value="{{ category.id }}">{{ category.name }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="form-group">
                <label style="display: flex; align-items: center; gap: 10px;">
                    <input type="checkbox" name="is_active" checked>
                    <span>Active (Generate content for this topic)</span>
                </label>
            </div>
            <div style="display: flex; gap: 15px; justify-content: end;">
                <button type="button" onclick="closeAddModal()" class="btn btn-secondary">Cancel</button>
                <button type="submit" class="btn btn-primary">Add Topic</button>
            </div>
        </form>
    </div>
</div>

<!-- Import CSV Modal -->
<div id="importModal" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 1000;">
    <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 30px; border-radius: 15px; width: 90%; max-width: 600px;">
        <h3 style="margin-bottom: 20px;">Import Topics from CSV</h3>
        <form action="{{ url_for('import_topics') }}" method="POST" enctype="multipart/form-data">
            <div class="form-group">
                <label class="form-label">CSV File</label>
                <input type="file" name="csv_file" class="form-input" accept=".csv" required>
            </div>
            <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                <strong>CSV Format:</strong>
                <p style="margin: 10px 0; font-family: monospace; font-size: 0.9em;">
                    topic_name,category_id<br>
                    DeFi Protocols,1<br>
                    NFT Marketplace,1<br>
                    Bitcoin Mining,4
                </p>
            </div>
            <div style="display: flex; gap: 15px; justify-content: end;">
                <button type="button" onclick="closeImportModal()" class="btn btn-secondary">Cancel</button>
                <button type="submit" class="btn btn-primary">Import Topics</button>
            </div>
        </form>
    </div>
</div>

<script>
function showAddModal() {
    document.getElementById('addModal').style.display = 'block';
}

function closeAddModal() {
    document.getElementById('addModal').style.display = 'none';
}

function showImportModal() {
    document.getElementById('importModal').style.display = 'block';
}

function closeImportModal() {
    document.getElementById('importModal').style.display = 'none';
}

function editTopic(id) {
    alert('Edit topic functionality - coming soon');
}

function deleteTopic(id) {
    if (confirm('Are you sure you want to delete this topic?')) {
        // Implement delete functionality
        alert('Delete functionality - coming soon');
    }
}

document.getElementById('addTopicForm').addEventListener('submit', function(e) {
    e.preventDefault();
    
    const formData = new FormData(this);
    const data = {
        topic_name: formData.get('topic_name'),
        category_id: formData.get('category_id'),
        is_active: formData.has('is_active')
    };
    
    // Implement AJAX submission
    alert('Topic will be added: ' + data.topic_name);
    closeAddModal();
});
</script>
{% endblock %}
